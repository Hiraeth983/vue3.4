<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Setup å‡½æ•°æµ‹è¯•</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      .test-case {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .test-case h3 {
        margin-top: 0;
      }
      button {
        padding: 8px 16px;
        margin: 5px;
        cursor: pointer;
      }
      .log {
        background: #f5f5f5;
        padding: 10px;
        margin-top: 10px;
        font-family: monospace;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>Setup å‡½æ•°æµ‹è¯•</h1>

    <div class="test-case">
      <h3>æµ‹è¯•1: setup è¿”å›å¯¹è±¡ï¼ˆæš´éœ²ç»™æ¨¡æ¿ï¼‰</h3>
      <div id="app1"></div>
    </div>

    <div class="test-case">
      <h3>æµ‹è¯•2: setup è¿”å›æ¸²æŸ“å‡½æ•°</h3>
      <div id="app2"></div>
    </div>

    <div class="test-case">
      <h3>æµ‹è¯•3: setup + ç”Ÿå‘½å‘¨æœŸé’©å­</h3>
      <div id="app3"></div>
      <div class="log" id="log3"></div>
    </div>

    <div class="test-case">
      <h3>æµ‹è¯•4: emit äº‹ä»¶</h3>
      <div id="app4"></div>
      <div class="log" id="log4"></div>
    </div>

    <div class="test-case">
      <h3>æµ‹è¯•5: props ä¼ é€’</h3>
      <div id="app5"></div>
    </div>

    <script type="module">
      import {
        h,
        render,
        ref,
        reactive,
        onBeforeMount,
        onMounted,
        onBeforeUpdate,
        onUpdated,
        onBeforeUnmount,
        onUnmounted,
        getCurrentInstance,
      } from "./runtime-dom.esm.js";
      // import {
      //   h,
      //   render,
      //   ref,
      //   reactive,
      //   onBeforeMount,
      //   onMounted,
      //   onBeforeUpdate,
      //   onUpdated,
      //   onBeforeUnmount,
      //   onUnmounted,
      //   getCurrentInstance,
      // } from "/node_modules/vue/dist/vue.esm-browser.js";

      // =====================
      // æµ‹è¯•1: setup è¿”å›å¯¹è±¡
      // =====================
      const App1 = {
        props: {},
        setup() {
          const count = ref(0);
          const increment = () => {
            count.value++;
          };
          // è¿”å›å¯¹è±¡ï¼Œæš´éœ²ç»™ render ä½¿ç”¨
          return { count, increment };
        },
        render() {
          // this å¯ä»¥è®¿é—® setupState
          return h("div", [
            h("p", `Count: ${this.count}`),
            h("button", { onClick: this.increment }, "ç‚¹å‡» +1"),
          ]);
        },
      };
      render(h(App1), document.getElementById("app1"));
      console.log("âœ… æµ‹è¯•1: setup è¿”å›å¯¹è±¡ - æ¸²æŸ“æˆåŠŸ");

      // =====================
      // æµ‹è¯•2: setup è¿”å›æ¸²æŸ“å‡½æ•°
      // =====================
      const App2 = {
        setup() {
          const count = ref(0);
          const increment = () => count.value++;

          // ç›´æ¥è¿”å›æ¸²æŸ“å‡½æ•°
          return () =>
            h("div", [
              h("p", `Count: ${count.value}`),
              h("button", { onClick: increment }, "ç‚¹å‡» +1"),
            ]);
        },
      };
      render(h(App2), document.getElementById("app2"));
      console.log("âœ… æµ‹è¯•2: setup è¿”å›æ¸²æŸ“å‡½æ•° - æ¸²æŸ“æˆåŠŸ");

      // =====================
      // æµ‹è¯•3: ç”Ÿå‘½å‘¨æœŸé’©å­
      // =====================
      const log3 = (msg) => {
        const el = document.getElementById("log3");
        el.textContent += msg + "\n";
        console.log(msg);
      };

      const App3 = {
        setup() {
          const count = ref(0);
          const show = ref(true);

          log3("setup æ‰§è¡Œ");

          onBeforeMount(() => {
            log3("onBeforeMount");
            const instance = getCurrentInstance();
            log3(`  getCurrentInstance: ${instance ? "âœ“ æœ‰å€¼" : "âœ— null"}`);
          });

          onMounted(() => {
            log3("onMounted");
          });

          onBeforeUpdate(() => {
            log3("onBeforeUpdate");
          });

          onUpdated(() => {
            log3("onUpdated");
          });

          return () =>
            h("div", [
              h("p", `Count: ${count.value}`),
              h("button", { onClick: () => count.value++ }, "è§¦å‘æ›´æ–°"),
            ]);
        },
      };
      render(h(App3), document.getElementById("app3"));
      console.log("âœ… æµ‹è¯•3: ç”Ÿå‘½å‘¨æœŸé’©å­ - æ¸²æŸ“æˆåŠŸ");

      // =====================
      // æµ‹è¯•4: emit äº‹ä»¶
      // =====================
      const log4 = (msg) => {
        const el = document.getElementById("log4");
        el.textContent += msg + "\n";
        console.log(msg);
      };

      const Child4 = {
        props: { value: Number },
        setup(props, { emit }) {
          const handleClick = () => {
            console.log("handleClick");
            emit("increment", props.value + 1);
            emit("custom-event", "hello", "world");
          };

          return () =>
            h(
              "button",
              { onClick: handleClick },
              `Child value: ${props.value}`
            );
        },
      };

      const App4 = {
        setup() {
          const count = ref(0);

          const onIncrement = (val) => {
            log4(`æ”¶åˆ° increment äº‹ä»¶, å€¼: ${val}`);
            count.value = val;
          };

          const onCustomEvent = (...args) => {
            log4(`æ”¶åˆ° custom-event äº‹ä»¶, å‚æ•°: ${JSON.stringify(args)}`);
          };

          return () =>
            h("div", [
              h("p", `Parent count: ${count.value}`),
              h(Child4, {
                value: count.value,
                onIncrement,
                "onCustom-event": onCustomEvent, // kebab-case äº‹ä»¶
              }),
            ]);
        },
      };
      render(h(App4), document.getElementById("app4"));
      console.log("âœ… æµ‹è¯•4: emit äº‹ä»¶ - æ¸²æŸ“æˆåŠŸ");

      // =====================
      // æµ‹è¯•5: props ä¼ é€’
      // =====================
      const Child5 = {
        props: {
          msg: String,
          count: Number,
        },
        setup(props) {
          // props åº”è¯¥æ˜¯å“åº”å¼çš„
          return () =>
            h("div", { style: "background: #e3f2fd; padding: 10px;" }, [
              h("p", `props.msg: ${props.msg}`),
              h("p", `props.count: ${props.count}`),
            ]);
        },
      };

      const App5 = {
        setup() {
          const count = ref(0);

          return () =>
            h("div", [
              h(Child5, { msg: "Hello from parent", count: count.value }),
              h("button", { onClick: () => count.value++ }, "æ›´æ–° props"),
            ]);
        },
      };
      render(h(App5), document.getElementById("app5"));
      console.log("âœ… æµ‹è¯•5: props ä¼ é€’ - æ¸²æŸ“æˆåŠŸ");

      console.log("\nğŸ‰ æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å·²æ¸²æŸ“ï¼Œè¯·åœ¨é¡µé¢ä¸Šæ‰‹åŠ¨æµ‹è¯•äº¤äº’");
    </script>
  </body>
</html>
