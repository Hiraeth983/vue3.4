<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Provide/Inject æµ‹è¯•</title>
    <style>
      .box { padding: 10px; margin: 10px; border: 1px solid #ccc; border-radius: 4px; }
      .app { background: #e3f2fd; }
      .parent { background: #fff3e0; }
      .child { background: #e8f5e9; }
      button { margin: 5px; padding: 5px 10px; cursor: pointer; }
      h2, h3, h4 { margin: 5px 0; }
      p { margin: 3px 0; }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <script type="module">
      import {
        render,
        h,
        provide,
        inject,
        ref,
        reactive,
      } from "./runtime-dom.esm.js";

      // ========== å­™ç»„ä»¶ï¼šinject æ•°æ® ==========
      const GrandChild = {
        setup() {
          // æ³¨å…¥ç¥–å…ˆæä¾›çš„æ•°æ®
          const theme = inject("theme");
          const count = inject("count");
          const user = inject("user");
          const notExist = inject("notExist", "é»˜è®¤å€¼");

          console.log("GrandChild inject:", { theme, count: count.value, user, notExist });

          return () =>
            h("div", { class: "box child" }, [
              h("h4", "ðŸ‘¶ GrandChild (inject)"),
              h("p", `theme: ${theme}`),
              h("p", `count: ${count.value}`),
              h("p", `user: ${user.name} - ${user.age}å²`),
              h("p", `notExist: ${notExist}`),
            ]);
        },
      };

      // ========== å­ç»„ä»¶ï¼šprovide è¦†ç›– + inject çˆ¶çº§æ•°æ® ==========
      const Child = {
        setup() {
          // æ³¨å…¥ App æä¾›çš„ theme
          const theme = inject("theme");

          // è‡ªå·± provide ä¸€ä¸ª countï¼ˆä¼šè¦†ç›–æ›´ä¸Šå±‚çš„åŒå provideï¼‰
          const count = ref(100);
          provide("count", count);

          return () =>
            h("div", { class: "box parent" }, [
              h("h3", "ðŸ‘¦ Child (provide count=100 è¦†ç›–çˆ¶çº§)"),
              h("p", `ç»§æ‰¿çš„ theme: ${theme}`),
              h("button", { onClick: () => count.value++ }, `Child count++: ${count.value}`),
              h(GrandChild),
            ]);
        },
      };

      // ========== çˆ¶ç»„ä»¶ ==========
      const Parent = {
        setup() {
          const count = inject("count");
          const theme = inject("theme");

          return () =>
            h("div", { class: "box parent" }, [
              h("h3", "ðŸ‘¨ Parent (inject App çš„æ•°æ®)"),
              h("p", `theme: ${theme}, count: ${count.value}`),
              h(Child),
            ]);
        },
      };

      // ========== æ ¹ç»„ä»¶ï¼šprovide æ•°æ® ==========
      const App = {
        setup() {
          // provide åŸºæœ¬å€¼
          provide("theme", "dark");

          // provide å“åº”å¼æ•°æ®
          const count = ref(0);
          provide("count", count);

          // provide å“åº”å¼å¯¹è±¡
          const user = reactive({ name: "Leo", age: 25 });
          provide("user", user);

          return () =>
            h("div", { class: "box app" }, [
              h("h2", "ðŸ  App (provide: theme, count, user)"),
              h("button", { onClick: () => count.value++ }, `App count++: ${count.value}`),
              h("button", { onClick: () => user.age++ }, `User age++: ${user.age}`),
              h("hr"),
              h(Parent),
            ]);
        },
      };

      render(h(App), document.getElementById("app"));
    </script>
  </body>
</html>
